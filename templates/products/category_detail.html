{% extends 'base.html' %}
{% load static %}

{% block title %}{{ category.name }} | {{ company_name }}{% endblock %}

{% block content %}
<!-- Page Hero -->
<section class="page-hero" style="padding: 100px 0 60px;">
    <div class="container" data-aos="fade-up">
        <div style="display: flex; gap: 0.5rem; font-size: 0.85rem; opacity: 0.6; margin-bottom: 1rem; text-transform: uppercase; font-weight: 700; letter-spacing: 1px;">
            <a href="{% url 'products:landing' %}">Products</a>
            <span>/</span>
            <span>{{ category.name }}</span>
        </div>
        <h1 style="color: white; margin-bottom: 0;">{{ category.name }}</h1>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="grid" style="grid-template-columns: 280px 1fr; gap: 4rem;">
            
            <!-- Sidebar -->
            <aside style="display: block;">
                <div style="position: sticky; top: 120px;">
                    <div style="background: var(--primary); color: white; padding: 1.25rem 2rem; border-radius: var(--radius-sm) var(--radius-sm) 0 0; font-weight: 700; font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase;">
                        Categories
                    </div>
                    <div class="card" style="border-radius: 0 0 var(--radius-sm) var(--radius-sm); border-top: none;">
                        <ul style="padding: 1rem 0;">
                            <li>
                                <a href="{% url 'products:landing' %}" style="display: flex; align-items: center; justify-content: space-between; padding: 0.8rem 2rem; font-size: 0.9rem; font-weight: 600; opacity: 0.7;">
                                    All Collection
                                    <i class="fas fa-chevron-right" style="font-size: 0.7rem;"></i>
                                </a>
                            </li>
                            {% for cat in all_categories %}
                            <li>
                                <a href="{{ cat.get_absolute_url }}" style="display: flex; align-items: center; justify-content: space-between; padding: 0.8rem 2rem; font-size: 0.9rem; font-weight: 600; {% if cat.id == category.id %}color: var(--accent-dark); opacity: 1; background: var(--bg-light); border-left: 4px solid var(--accent);{% else %}opacity: 0.7;{% endif %}">
                                    {{ cat.name }}
                                    <i class="fas fa-chevron-right" style="font-size: 0.7rem;"></i>
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <div class="card" style="margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, var(--primary) 0%, #163a5f 100%); color: white; border: none;">
                        <h4 style="color: white; margin-bottom: 1rem;">Need Help?</h4>
                        <p style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 1.5rem;">Speak with our industrial chemical experts for technical guidance.</p>
                        <a href="{% url 'core:contact' %}" class="btn btn-accent" style="width: 100%; font-size: 0.75rem; padding: 0.7rem;">Talk to Expert</a>
                    </div>
                </div>
            </aside>

            <!-- Main Listing -->
            <div>
                {% if category.description %}
                <div class="card" style="padding: 2.5rem; margin-bottom: 3rem; background: var(--bg-white); border-left: 4px solid var(--accent);" data-aos="fade-up">
                    <h3 style="margin-bottom: 1rem; font-size: 1.2rem;">About {{ category.name }}</h3>
                    <p style="color: var(--text-muted); line-height: 1.8;">{{ category.description }}</p>
                </div>
                {% endif %}

                <div class="grid grid-3">
                    {% for product in products %}
                    <div class="card" style="display: flex; flex-direction: column;" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                        <!-- Product Image -->
                        <div style="height: 220px; background: white; display: flex; align-items: center; justify-content: center; padding: 1.5rem; position: relative;">
                            {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-height: 100%; max-width: 100%; object-fit: contain; transition: var(--transition);">
                            {% else %}
                            <i class="fas fa-box" style="font-size: 4rem; color: var(--border);"></i>
                            {% endif %}
                            <style>
                                .card:hover img { transform: scale(1.1); }
                            </style>
                        </div>

                        <!-- Product Info -->
                        <div style="padding: 1.5rem; border-top: 1px solid var(--border); flex: 1; display: flex; flex-direction: column;">
                            <h3 style="font-size: 1.05rem; line-height: 1.4; margin-bottom: 0.5rem; height: 2.8em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                <a href="{{ product.get_absolute_url }}">{{ product.name }}</a>
                            </h3>
                            <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1.5rem; height: 3.2em; overflow: hidden;">
                                {{ product.short_description|truncatewords:10 }}
                            </p>
                            
                            <!-- Actions -->
                            <div style="margin-top: auto; display: grid; grid-template-columns: 1fr auto; gap: 0.75rem;">
                                <a href="{{ product.get_absolute_url }}" class="btn btn-outline" style="padding: 0.6rem; font-size: 0.8rem;">View Specs</a>
                                <a href="{% url 'inquiries:add_to_quote' product.id %}" class="btn btn-primary" style="padding: 0.6rem 1.2rem; font-size: 0.8rem; border-radius: 4px;" title="Add to Quote">
                                    <i class="fas fa-plus"></i> Quote
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div style="grid-column: 1 / -1; text-align: center; padding: 5rem 0;">
                        <i class="fas fa-box-open" style="font-size: 4rem; color: var(--border); margin-bottom: 2rem;"></i>
                        <h3 style="color: var(--text-muted);">No products found in this category.</h3>
                        <a href="{% url 'products:landing' %}" class="btn btn-primary" style="margin-top: 2rem;">Back to Catalog</a>
                    </div>
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>
</section>

{% endblock %}
