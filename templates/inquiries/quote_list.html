{% extends 'base.html' %}
{% load static %}

{% block title %}Request Quote | {{ company_name }}{% endblock %}

{% block content %}
<!-- Header / Progress Bar -->
<section style="background: linear-gradient(135deg, var(--bg-dark) 0%, #0f172a 100%); color: var(--white); padding: 5rem 0 3rem; text-align: center; position: relative; overflow: hidden;">
    <!-- Decorative Elements -->
    <div style="position: absolute; top: -50%; right: -10%; width: 500px; height: 500px; background: radial-gradient(circle, rgba(49,130,206,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
    
    <div class="container" style="position: relative; z-index: 2;">
        <div style="display: inline-block; padding: 0.5rem 1.5rem; background: rgba(49,130,206,0.2); border-radius: 50px; margin-bottom: 1.5rem;">
            <i class="fas fa-clipboard-check" style="margin-right: 8px; color: var(--accent-color);"></i>
            <span style="font-size: 0.85rem; font-weight: 600; color: var(--accent-color); text-transform: uppercase; letter-spacing: 1px;">Quote Request</span>
        </div>
        
        <h1 style="margin-bottom: 1rem; font-size: 2.5rem; font-weight: 800;">Build Your Custom Quote</h1>
        <p style="font-size: 1.1rem; opacity: 0.9; max-width: 600px; margin: 0 auto 3rem;">Review your selected products and submit your inquiry. Our team will respond within 24 hours.</p>
        
        <!-- Progress Steps -->
        <div style="display: flex; justify-content: center; align-items: center; gap: 2rem; max-width: 600px; margin: 0 auto;">
            <div style="text-align: center; position: relative;">
                <div style="width: 50px; height: 50px; background: var(--accent-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; margin: 0 auto 0.75rem; box-shadow: 0 0 20px rgba(49,130,206,0.4);">
                    <i class="fas fa-check"></i>
                </div>
                <span style="font-size: 0.9rem; font-weight: 600;">Review Items</span>
            </div>
            <div style="flex: 1; height: 3px; background: linear-gradient(90deg, var(--accent-color) 0%, rgba(255,255,255,0.3) 100%); margin-top: -2rem; border-radius: 10px;"></div>
            <div style="text-align: center;">
                <div style="width: 50px; height: 50px; background: rgba(255,255,255,0.2); border: 3px solid var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; margin: 0 auto 0.75rem; backdrop-filter: blur(10px);">2</div>
                <span style="font-size: 0.9rem; font-weight: 600;">Submit Request</span>
            </div>
        </div>
    </div>
</section>

<section class="section" style="background: linear-gradient(180deg, var(--bg-body) 0%, #ffffff 100%);">
    <div class="container" style="max-width: 1100px;">
        
        {% if cart_items %}
        <div style="display: grid; gap: 3rem;">
            
            <!-- REVIEW ITEMS WITH CONTROLS -->
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); font-size: 1.5rem; margin: 0;">
                        <i class="fas fa-shopping-cart" style="margin-right: 10px; color: var(--accent-color);"></i>
                        Selected Products
                    </h3>
                    <span style="background: var(--accent-color); color: white; padding: 0.5rem 1rem; border-radius: 50px; font-weight: 600; font-size: 0.9rem;">
                        {{ cart_items|length }} Item{{ cart_items|length|pluralize }}
                    </span>
                </div>
                
                <div class="card" style="border: none; box-shadow: var(--shadow-lg); overflow: hidden;">
                    {% for item in cart_items %}
                    <div style="padding: 2rem; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 1.5rem; transition: background 0.2s; {% if forloop.last %}border-bottom: none;{% endif %}" class="quote-item">
                        <!-- Product Image -->
                        <div style="flex-shrink: 0;">
                            {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius-md); box-shadow: var(--shadow-sm);">
                            {% else %}
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-box" style="color: #94a3b8; font-size: 2rem;"></i>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Product Info -->
                        <div style="flex: 1; min-width: 0;">
                            <h4 style="margin-bottom: 0.5rem; font-size: 1.1rem; font-weight: 700; color: var(--primary-color);">{{ item.product.name }}</h4>
                            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                <span style="font-size: 0.85rem; color: var(--text-muted); background: var(--bg-body); padding: 0.25rem 0.75rem; border-radius: 4px;">
                                    <i class="fas fa-tag" style="margin-right: 5px;"></i>{{ item.product.category.name }}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Quantity Controls -->
                        <div style="display: flex; align-items: center; gap: 0.75rem; background: var(--bg-body); border-radius: var(--radius-md); padding: 0.5rem 0.75rem; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
                            <a href="{% url 'inquiries:update_quote' item.product.id 'decrease' %}" style="width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--white); border-radius: 6px; color: var(--text-main); text-decoration: none; transition: all 0.2s; box-shadow: var(--shadow-sm);" class="qty-btn">
                                <i class="fas fa-minus" style="font-size: 0.85rem;"></i>
                            </a>
                            <span style="min-width: 50px; text-align: center; font-weight: 700; font-size: 1.1rem; color: var(--primary-color);">{{ item.quantity }}</span>
                            <a href="{% url 'inquiries:update_quote' item.product.id 'increase' %}" style="width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--white); border-radius: 6px; color: var(--text-main); text-decoration: none; transition: all 0.2s; box-shadow: var(--shadow-sm);" class="qty-btn">
                                <i class="fas fa-plus" style="font-size: 0.85rem;"></i>
                            </a>
                        </div>
                        
                        <!-- Remove Button -->
                        <a href="{% url 'inquiries:remove_from_quote' item.product.id %}" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.05) 100%); border-radius: var(--radius-md); color: #dc2626; text-decoration: none; transition: all 0.3s; border: 1px solid rgba(220, 38, 38, 0.2);" title="Remove Item" class="remove-btn">
                            <i class="fas fa-trash-alt" style="font-size: 1rem;"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- CONTACT FORM -->
            <div>
                <h3 style="margin-bottom: 2rem; color: var(--primary-color); font-size: 1.5rem;">
                    <i class="fas fa-user-circle" style="margin-right: 10px; color: var(--accent-color);"></i>
                    Your Contact Information
                </h3>
                
                <div class="card glass-card" style="padding: 3rem; border: 1px solid var(--border-color); box-shadow: var(--shadow-lg);">
                    <form method="post" action="{% url 'inquiries:quote_list' %}" id="quoteForm">
                        {% csrf_token %}
                        <div class="grid grid-2" style="gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-user" style="color: var(--accent-color);"></i> Full Name
                                </label>
                                <input type="text" name="name" class="form-control" required placeholder="John Doe" style="border: 2px solid var(--border-color);">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-phone" style="color: var(--accent-color);"></i> Phone Number
                                </label>
                                <input type="tel" name="phone" class="form-control" required placeholder="+92 300 0000000" style="border: 2px solid var(--border-color);">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-envelope" style="color: var(--accent-color);"></i> Email Address
                            </label>
                            <input type="email" name="email" class="form-control" required placeholder="john@company.com" style="border: 2px solid var(--border-color);">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-comment-dots" style="color: var(--accent-color);"></i> Additional Requirements
                            </label>
                            <textarea name="message" class="form-control" rows="4" placeholder="Tell us about your specific needs, quantities, delivery timeline, etc." style="border: 2px solid var(--border-color);"></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-block" style="padding: 1.25rem; font-size: 1.15rem; margin-top: 1.5rem; font-weight: 700; letter-spacing: 0.5px; box-shadow: 0 4px 15px rgba(49,130,206,0.3);">
                            <i class="fas fa-paper-plane" style="margin-right: 10px;"></i> Submit Quote Request
                        </button>
                        
                        <p style="text-align: center; margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-muted);">
                            <i class="fas fa-shield-alt" style="color: var(--accent-color); margin-right: 5px;"></i>
                            Your information is secure and will only be used to process your quote.
                        </p>
                    </form>
                </div>
            </div>
            
        </div>
        {% else %}
        <div style="text-align: center; padding: 6rem 2rem; background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-md);">
            <div style="width: 120px; height: 120px; background: linear-gradient(135deg, var(--bg-body) 0%, #e2e8f0 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem; box-shadow: inset 0 4px 10px rgba(0,0,0,0.05);">
                <i class="fas fa-clipboard-list" style="font-size: 3.5rem; color: var(--text-muted);"></i>
            </div>
            <h2 style="margin-bottom: 1rem; font-size: 2rem;">Your Quote List is Empty</h2>
            <p style="color: var(--text-muted); margin-bottom: 2.5rem; font-size: 1.1rem; max-width: 500px; margin-left: auto; margin-right: auto;">Start building your custom quote by browsing our extensive product catalog.</p>
            <a href="{% url 'products:landing' %}" class="btn btn-primary" style="padding: 1rem 3rem; font-size: 1.1rem;">
                <i class="fas fa-search" style="margin-right: 10px;"></i> Browse Products
            </a>
        </div>
        {% endif %}
    </div>
</section>

<style>
    .qty-btn:hover {
        transform: scale(1.1);
        background: var(--accent-color) !important;
        color: white !important;
        box-shadow: var(--shadow-md);
    }
    
    .remove-btn:hover {
        transform: scale(1.1);
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.15) 100%) !important;
        border-color: #dc2626 !important;
    }
    
    .quote-item:hover {
        background: rgba(49,130,206,0.02);
    }
    
    .form-control:focus {
        border-color: var(--accent-color) !important;
    }
</style>

<!-- Success Animation JS -->
<script>
    document.getElementById('quoteForm')?.addEventListener('submit', function(e) {
        const btn = this.querySelector('button[type="submit"]');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending Your Request...';
        btn.disabled = true;
        btn.style.opacity = '0.7';
    });
</script>
{% endblock %}
